<!doctype html>
<!-- v3 -->
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>DocuSign Handback</title>
<style>
  body { font: 16px/1.45 -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif; padding: 24px; }
  .btn { display:inline-block; padding:12px 16px; border:1px solid #222; border-radius:10px; text-decoration:none; }
  code { background:#f4f4f4; padding:2px 6px; border-radius:6px }
  .raw { margin-top: 12px; font-size: 14px; }
</style>
<script>
  // Build a lowercased map of all query params for case-insensitive lookup
  const rawQs = location.search.replace(/^\?/, '');
  const qp = new URLSearchParams(location.search);
  const map = {};
  for (const [k, v] of qp.entries()) map[k.toLowerCase()] = v;

  const event = map['event'] || '(none)';
  const state = map['state'] || '(none)';
  // Accept any common variants + our fallback key
  const envelopeId = map['envelopeid'] || map['eid'] || '(unknown)';

  document.addEventListener('DOMContentLoaded', () => {
    document.body.innerHTML = `
      <h2>DocuSign returned</h2>
      <p><strong>event</strong>: <code>${event}</code></p>
      <p><strong>state</strong>: <code>${state}</code></p>
      <p><strong>envelopeId</strong>: <code>${envelopeId}</code></p>

      <div class="raw">
        <div><strong>raw query:</strong></div>
        <code>${rawQs || '(no query params)'}</code>
      </div>

      <p style="margin-top:20px">
        <a class="btn" href="https://guest.yourdomain.com/check-in">Return to Check-in</a>
      </p>
    `;
  });
</script>
